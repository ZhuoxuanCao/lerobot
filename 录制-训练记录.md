## å½•åˆ¶ (Recording)

### å½•åˆ¶æŒ‡ä»¤

æ–‡ä»¶ä¸­åŒ…å«ä»¥ä¸‹ç”¨äºæ•°æ®å½•åˆ¶çš„ `lerobot-record` æŒ‡ä»¤ï¼š

**æ¸…é™¤ç¼“å­˜æŒ‡ä»¤**

```
rm /home/cao/.cache/huggingface/lerobot/cao/so101_stack_blue_on_green_v1
```

**å¯ç”¨è§†é¢‘ä¿å­˜ (æµ‹è¯•ç‰ˆ)**

```bash
# å¯ç”¨è§†é¢‘ä¿å­˜
# æµ‹è¯•ç‰ˆ
lerobot-record \
  --robot.type=so101_follower \
  --robot.port=/dev/ttyACM1 \
  --robot.id=follower_arm_v1 \
  --robot.cameras="{ \
    top:  {type: opencv, index_or_path: /dev/video0, width: 320, height: 240, fps: 20, warmup_s: 5}, \
    hand: {type: opencv, index_or_path: /dev/video2, width: 640, height: 480, fps: 20, warmup_s: 5} \
  }" \
  --teleop.type=so101_leader \
  --teleop.port=/dev/ttyACM0 \
  --teleop.id=leader_arm_v1 \
  --display_data=false \
  --dataset.repo_id=${USER}/so101_stack_blue_on_green_v1 \
  --dataset.num_episodes=5 \
  --dataset.single_task="stack_blue_on_green" \
  --dataset.episode_time_s=60 \
  --dataset.reset_time_s=20 \
  --dataset.fps=20 \
  --dataset.push_to_hub=false \
  --dataset.video=true \
  --dataset.num_image_writer_processes=1 \
  --dataset.num_image_writer_threads_per_camera=2 \
  --play_sounds=true 
```

**å¯ç”¨è§†é¢‘ä¿å­˜ (v6 - ç»¿è‰²æ–¹å—åœ¨åº•å±‚)**

```bash
# å¯ç”¨è§†é¢‘ä¿å­˜
v1 v2æ˜¯åœ¨æœ‰é—®é¢˜çš„æœºæ¢°è‡‚ä¸Šæµ‹è¯•çš„ï¼Œæˆ‘ä»¬ç°åœ¨æ”¾å¼ƒï¼Œæ–°æœºæ¢°è‡‚ä»v3å¼€å§‹

# å°†ç»¿è‰²æ–¹å—æ”¾åœ¨åº•å±‚

lerobot-record \
  --robot.type=so101_follower \
  --robot.port=/dev/ttyACM1 \
  --robot.id=follower_arm_v1 \
  --robot.cameras="{ \
    top:  {type: opencv, index_or_path: /dev/video0, width: 320, height: 240, fps: 30, warmup_s: 5}, \
    hand: {type: opencv, index_or_path: /dev/video2, width: 640, height: 480, fps: 30, warmup_s: 5} \
  }" \
  --teleop.type=so101_leader \
  --teleop.port=/dev/ttyACM0 \
  --teleop.id=leader_arm_v1 \
  --display_data=false \
  --dataset.repo_id=${USER}/so101_stack_green_on_bottom_v6 \
  --dataset.num_episodes=30 \
  --dataset.single_task="stack_green_on_bottom" \
  --dataset.episode_time_s=45 \
  --dataset.reset_time_s=12 \
  --dataset.fps=30 \
  --dataset.push_to_hub=false \
  --dataset.video=true \
  --dataset.num_image_writer_processes=1 \
  --dataset.num_image_writer_threads_per_camera=2 \
  --play_sounds=false
```

### å½•åˆ¶è®°å½•

#### **ç»¿è‰²æ–¹å—æ”¾åœ¨åº•å±‚ (so101\_stack\_green\_on\_bottom)**

  * v1ï¼Œv2ï¼šä½¿ç”¨è€æœºæ¢°è‡‚ï¼Œå„æ‰§è¡Œäº†10æ¬¡ï¼Œå¸§ç‡ä¸º20

  * v3ï¼šä½¿ç”¨æ–°æœºæ¢°è‡‚ï¼Œæ‰§è¡Œäº†15æ¬¡ï¼Œå¸§ç‡ä¸º30, --dataset.single\_task="stack\_green\_on\_bottom"

  * v4ï¼šä½¿ç”¨æ–°æœºæ¢°è‡‚ï¼Œæ‰§è¡Œäº†40æ¬¡ï¼Œå¸§ç‡ä¸º30, --dataset.single\_task="stack\_green\_on\_bottom" ï¼ˆäº”å±‚çº¸ï¼Œé»‘å¸ƒï¼Œé»‘æ¡†ï¼‰

    

    **v1234éƒ½æ˜¯demoï¼Œä»v4å¼€å§‹ï¼Œæ”¾ç½®åŒºçš„æ–¹å—ä»¥gbré¡ºåºæ’åˆ—**

    

  * v5ï¼šä½¿ç”¨æ–°æœºæ¢°è‡‚ï¼Œæ‰§è¡Œäº†40æ¬¡ï¼Œå¸§ç‡ä¸º30, --dataset.single\_task="stack\_green\_on\_bottom" ï¼ˆäº”å±‚çº¸ï¼Œé»‘å¸ƒï¼Œé»‘æ¡†ï¼ŒåŠ ä¸Šä¸€ä¸ªè“è‰²ä¸€ä¸ªç´«è‰²åœ¨å¾…æŠ“å–åŒºåŸŸï¼‰

  * v6ï¼šä½¿ç”¨æ–°æœºæ¢°è‡‚ï¼Œæ‰§è¡Œäº†30æ¬¡ï¼Œå¸§ç‡ä¸º30, --dataset.single\_task="stack\_green\_on\_bottom" ï¼ˆäº”å±‚çº¸ï¼Œé»‘å¸ƒï¼Œé»‘æ¡†+çº¢çº¿ï¼ŒåŠ ä¸Šä¸€ä¸ªè“è‰²ä¸€ä¸ªç´«è‰²åœ¨å¾…æŠ“å–åŒºåŸŸï¼ŒåŠ å…¥ç­‰å¾…ï¼‰

#### **è“è‰²æ–¹å—æ”¾åœ¨ç¬¬äºŒå±‚ (so101\_stack\_blue\_on\_second\_layer)**

  * v1ï¼šæ‰§è¡Œäº†20æ¬¡ï¼Œå¸§ç‡ä¸º30ï¼Œ10æ¬¡ç»¿è‰²åœ¨ä¸‹é¢ï¼Œ10æ¬¡ç´«è‰²åœ¨ä¸‹é¢ï¼Œ--dataset.single\_task="stack\_blue\_on\_second\_layer"

  * v2ï¼šæ‰§è¡Œäº†10æ¬¡ï¼Œå¸§ç‡ä¸º30ï¼Œ10æ¬¡ç»¿è‰²åœ¨ä¸‹é¢--dataset.single\_task="stack\_blue\_on\_second\_layer"(ç”¨äºåˆå¹¶æ•°æ®é›†è®­ç»ƒçš„æµ‹è¯•)

  * v3ï¼šæ‰§è¡Œäº†10æ¬¡ï¼Œå¸§ç‡ä¸º30ï¼Œ10æ¬¡ç´«è‰²åœ¨ä¸‹é¢--dataset.single\_task="stack\_blue\_on\_second\_layer"(ç”¨äºåˆå¹¶æ•°æ®é›†è®­ç»ƒçš„æµ‹è¯•)

    

    **v123éƒ½æ˜¯demoï¼Œä»v4å¼€å§‹ï¼Œæ”¾ç½®åŒºçš„æ–¹å—ä»¥gbré¡ºåºæ’åˆ—**

    

  * v4ï¼šæ‰§è¡Œäº†15æ¬¡ï¼Œå¸§ç‡ä¸º30ï¼Œ15æ¬¡ç»¿è‰²åœ¨ä¸‹é¢--dataset.single\_task="stack\_blue\_on\_second\_layer"(ç”¨äºåˆå¹¶æ•°æ®é›†è®­ç»ƒçš„æµ‹è¯•ï¼Œç©ºå¿ƒé»‘æ¡†ï¼Œä¸‹é¢ç»¿è‰²æ–¹å—åœ¨ä¸­é—´)

  * v5ï¼šæ‰§è¡Œäº†20æ¬¡ï¼Œå¸§ç‡ä¸º30ï¼Œ20æ¬¡ç»¿è‰²åœ¨ä¸‹é¢--dataset.single\_task="stack\_blue\_on\_second\_layer"(ç”¨äºåˆå¹¶æ•°æ®é›†è®­ç»ƒçš„æµ‹è¯•ï¼Œç©ºå¿ƒé»‘æ¡†ï¼Œä¸‹é¢ç»¿è‰²æ–¹å—åœ¨é»‘æ¡†çš„ä¸Šä¸‹å·¦å³ï¼‰

  * v6ï¼šæ‰§è¡Œäº†20æ¬¡ï¼Œå¸§ç‡ä¸º30ï¼Œ20æ¬¡ç»¿è‰²åœ¨ä¸‹é¢--dataset.single\_task="stack\_blue\_on\_second\_layer"(ç”¨äºåˆå¹¶æ•°æ®é›†è®­ç»ƒçš„æµ‹è¯•ï¼Œç©ºå¿ƒé»‘æ¡†ï¼Œä¸‹é¢ç»¿è‰²æ–¹å—åœ¨é»‘æ¡†çš„å››è§’ï¼‰

-----

## ğŸ§  è®­ç»ƒ (Training)

### è®­ç»ƒæŒ‡ä»¤

æ–‡ä»¶ä¸­åŒ…å«ä»¥ä¸‹ç”¨äºæ¨¡å‹è®­ç»ƒçš„ `lerobot-train` æŒ‡ä»¤ï¼š

**è®­ç»ƒ "blue\_on\_second\_layer\_v4"**

```bash
  lerobot-train \
  --dataset.repo_id=cao/so101_stack_blue_on_second_layer_v4 \
  --policy.type=act \
  --output_dir=outputs/act/so101_stack_blue_on_second_layer_v4_act \
  --job_name=so101_stack_blue_on_second_layer_v4 \
  --policy.device=cuda \
  --batch_size=16 \
  --steps=10000 \
  --save_checkpoint=true \
  --save_freq=5000 \
  --log_freq=50 \
  --eval_freq=1000 \
  --wandb.enable=true \
  --wandb.project=lerobot-act \
  --wandb.notes="SO-101 stacking task: blue squares at second layer, using the v4 dataset" \
  --policy.push_to_hub=false
```

**è®­ç»ƒ "green\_on\_bottom\_v6"**

```bash
   lerobot-train \
  --dataset.repo_id="cao/so101_stack_green_on_bottom_v6" \
  --policy.type=act \
  --output_dir=outputs/act/so101_so101_stack_green_on_bottom_v6_act \
  --job_name=so101_stack_green_on_bottom_v6 \
  --policy.device=cuda \
  --batch_size=16 \
  --steps=15000 \
  --save_checkpoint=true \
  --save_freq=5000 \
  --log_freq=50 \
  --eval_freq=1000 \
  --wandb.enable=true \
  --wandb.project=lerobot-act \
  --wandb.notes="SO-101 stacking task: green squares at bottom, using the v6 dataset" \
  --policy.push_to_hub=false
```

**è®­ç»ƒ "blue\_mix\_v456" (å¤šæ•°æ®é›†)**

```bash
lerobot-train \
  --dataset.repo_id="cao/so101_stack_blue_on_second_layer_v4,cao/so101_stack_blue_on_second_layer_v5,cao/so101_stack_blue_on_second_layer_v6" \
  --policy.type=act \
  --output_dir=outputs/act/so101_blue_mix_v456 \
  --job_name=so101_blue_mix_v456_with_aug \
  --policy.device=cuda \
  --batch_size=16 \
  --steps=20000 \
  --save_checkpoint=true \
  --save_freq=5000 \
  --log_freq=50 \
  --eval_freq=1000 \
  --dataset.image_transforms.enable=true \
  --dataset.image_transforms.max_num_transforms=3 \
  --wandb.enable=true \
  --wandb.project=lerobot-act \
  --wandb.notes="SO-101 blue stacking v4+v5+v6 with image augmentation" \
  --policy.push_to_hub=false
```

**å…³äºå¤šæ•°æ®é›†è®­ç»ƒçš„ä¿®æ”¹è¯´æ˜**

> ä¸ºäº†å°è¯•å…¼å®¹å¤šæ•°æ®é›†è®­ç»ƒï¼Œæˆ‘ä»¬ä¿®æ”¹äº†`lerobot/datasets/factory.py` æ–‡ä»¶å†…å®¹ï¼Œä»¥åŠæ³¨é‡Šäº†lerobot/src/lerobot/configs/train.pyçš„110-111è¡Œï¼Œå¦‚æœæœ‰é—®é¢˜æˆ‘ä»¬å¯ä»¥éšæ—¶æ¢å¤æºä»£ç 

**è®­ç»ƒ "stack\_v6\_dropout\_p0.3" (Modality Dropout)**

```bash
lerobot-train \
  --dataset.repo_id="cao/so101_stack_green_on_bottom_v6" \
  --policy.type=act \
  --output_dir=outputs/act/so101_modality_dropout_p03 \
  --job_name=so101_stack_v6_dropout_p0.3 \
  --policy.device=cuda \
  --batch_size=16 \
  --steps=15000 \
  --save_checkpoint=true \
  --save_freq=5000 \
  --log_freq=50 \
  --eval_freq=1000 \
  --wandb.enable=true \
  --wandb.project=lerobot-act \
  --wandb.notes="SO-101 stacking: modality dropout p=0.3 to fix systematic placement bias" \
  --policy.push_to_hub=false \
  --policy.use_modality_dropout=true \
  --policy.modality_dropout_prob=0.3
```

### è®­ç»ƒè®°å½•

#### **ç»¿è‰²æ–¹å—æ”¾åœ¨åº•å±‚ (so101\_stack\_blue\_on\_second\_layer)ï¼Œè®°å½•**

  * v3ï¼šä½¿ç”¨so101\_stack\_green\_on\_bottom\_v3ï¼Œè¾“å‡ºoutputs/act/so101\_stack\_green\_on\_bottom\_v3\_actï¼Œbs=16ï¼Œsteps=10000
  * v5ï¼šä½¿ç”¨so101\_stack\_green\_on\_bottom\_v5ï¼Œè¾“å‡ºoutputs/act/so101\_stack\_green\_on\_bottom\_v5\_actï¼Œbs=16ï¼Œsteps=20000
  * v6ï¼šä½¿ç”¨so101\_stack\_green\_on\_bottom\_v6ï¼Œè¾“å‡ºoutputs/act/so101\_stack\_green\_on\_bottom\_v6\_actï¼Œbs=16ï¼Œsteps=15000
  * **so101_stack_v6_dropout_p0.3**ï¼šä½¿ç”¨ so101_stack_green_on_bottom_v6ï¼Œè¾“å‡º outputs/act/so101_modality_dropout_p03ï¼Œbs=16ï¼Œsteps=15000 (å¤‡æ³¨ï¼šä½¿ç”¨ modality dropout p=0.3)

#### **è“è‰²æ–¹å—æ”¾åœ¨ç¬¬äºŒå±‚ (so101\_stack\_blue\_on\_second\_layer)ï¼Œè®°å½•**

  * v1ï¼šä½¿ç”¨so101\_stack\_blue\_on\_second\_layer\_v1ï¼Œè¾“å‡ºoutputs/act/so101\_stack\_blue\_on\_second\_layer\_v1\_actï¼Œbs=16ï¼Œsteps=12500
  * v2ï¼šä½¿ç”¨so101\_stack\_blue\_on\_second\_layer\_v2 & so101\_stack\_blue\_on\_second\_layer\_v3ï¼Œè¾“å‡ºoutputs/act/so101\_stack\_blue\_on\_second\_layer\_mix\_v1\_actï¼Œbs=16ï¼Œsteps=20000
  * v3ï¼šä½¿ç”¨so101\_stack\_blue\_on\_second\_layer\_v4ï¼Œè¾“å‡ºoutputs/act/so101\_stack\_blue\_on\_second\_layer\_v4\_actï¼Œbs=16ï¼Œsteps=10000
  * so101\_blue\_mix\_v456ï¼Œä½¿ç”¨so101\_stack\_blue\_on\_second\_layer\_v4 5 6è¿›è¡Œè®­ç»ƒï¼Œbs=16ï¼Œsteps=20000

-----

## å·¥ä½œ (Work / è¯„ä¼°)

æ­¤éƒ¨åˆ†åŒ…å«ä½¿ç”¨ `lerobot-record` ç»“åˆå·²è®­ç»ƒç­–ç•¥ï¼ˆ`--policy.path`ï¼‰è¿›è¡Œè¯„ä¼°çš„æŒ‡ä»¤ã€‚

**è¯„ä¼° "so101\_stack\_blue\_on\_second\_layer\_v1\_act"**

```bash
lerobot-record \
  --robot.type=so101_follower \
  --robot.port=/dev/ttyACM1 \
  --robot.id=follower_arm_v1 \
  --robot.cameras="{ \
    top: {type: opencv, index_or_path: /dev/video0, width: 320, height: 240, fps: 30}, \
    hand: {type: opencv, index_or_path: /dev/video2, width: 640, height: 480, fps: 30} \
  }" \
  --display_data=false \
  --dataset.repo_id=${USER}/eval_so101_stack_blue_on_second_layer_v1 \
  --dataset.single_task="stack_blue_on_second_layer" \
  --dataset.num_episodes=5 \
  --dataset.episode_time_s=30 \
  --dataset.fps=30 \
  --dataset.push_to_hub=false \
  --dataset.video=true \
  --play_sounds=false \
  --policy.path=outputs/act/so101_stack_blue_on_second_layer_v1_act/checkpoints/last/pretrained_model
```

**è¯„ä¼° "so101\_stack\_blue\_on\_second\_layer\_v4\_act"**

```bash
  lerobot-record \
  --robot.type=so101_follower \
  --robot.port=/dev/ttyACM1 \
  --robot.id=follower_arm_v1 \
  --robot.cameras="{ top: {type: opencv, index_or_path: /dev/video0, width: 320, height: 240, fps: 30}, hand: {type: opencv, index_or_path: /dev/video2, width: 640, height: 480, fps: 30} }" \
  --teleop.type=so101_leader \
  --teleop.port=/dev/ttyACM0 \
  --teleop.id=leader_arm_v1 \
  --display_data=false \
  --dataset.repo_id=${USER}/eval_so101_stack_blue_on_second_layer_v4_act \
  --dataset.single_task="stack_green_on_bottom" \
  --dataset.num_episodes=1 \
  --dataset.episode_time_s=30 \
  --dataset.fps=30 \
  --dataset.push_to_hub=false \
  --dataset.video=true \
  --play_sounds=false \
  --policy.path=outputs/act/so101_stack_blue_on_second_layer_v4_act/checkpoints/last/pretrained_model
  
  
  
 rm -rf ~/.cache/huggingface/lerobot/cao/eval_so101_stack_blue_on_second_layer_v4_act
```

**è¯„ä¼° "so101\_blue\_mix\_v456"**

```bash
  lerobot-record \
  --robot.type=so101_follower \
  --robot.port=/dev/ttyACM1 \
  --robot.id=follower_arm_v1 \
  --robot.cameras="{ top: {type: opencv, index_or_path: /dev/video0, width: 320, height: 240, fps: 30}, hand: {type: opencv, index_or_path: /dev/video2, width: 640, height: 480, fps: 30} }" \
  --teleop.type=so101_leader \
  --teleop.port=/dev/ttyACM0 \
  --teleop.id=leader_arm_v1 \
  --display_data=false \
  --dataset.repo_id=${USER}/eval_so101_blue_mix_v456 \
  --dataset.single_task="stack_blue_on_second_layer" \
  --dataset.num_episodes=1 \
  --dataset.episode_time_s=30 \
  --dataset.fps=30 \
  --dataset.push_to_hub=false \
  --dataset.video=true \
  --play_sounds=false \
  --policy.path=outputs/act/so101_blue_mix_v456/checkpoints/last/pretrained_model

  

 rm -rf ~/.cache/huggingface/lerobot/cao/eval_so101_blue_mix_v456
```
